{{define "upload_image"}}
{{template "header"}}
<div class="row">
    <div class="col-md-6 col-md-offset-3">
        <div id="add-image" class="add-image">
            <form method="POST" action="/images/upload" enctype="multipart/form-data">
                <div class="form-group row">
                    <label for="imageFile" class="form-control-label col-sm-4 col-md-4 align-right">Image</label>
                    <div class="col-sm-8 col-md-8">
                        <input id="image_file" name="image_file" type="file"/>
                    </div>
                </div>
                
                <div class="form-group row">
                    <label for="displayName" class="form-control-label col-sm-4 col-md-4 align-right">Give it a tag</label>
                    <div class="col-sm-8 col-md-8">
                        <input id="tag_value" name="tag_value" type="text" class="form-control" placeholder="lolz" autocomplete="off" data-provide="typeahead"/>
                    </div>
                </div>
             
                <div class="form-group row align-right">
                    <button type="submit" class="btn btn-primary">Upload</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript">
jQuery('#tag_value').typeahead({
    items: 10,
    minLength: 2,
    source: function(query, cb) {
        jQuery.get('/api/tags.search/?query=' + query).success(function(datums) {
            if (typeof(datums.response) !== 'undefined' && typeof(datums.response.length) !== 'undefined' && datums.response.length > 0) {
                var values = [];
                for (var x = 0; x < datums.response.length; x++) {
                    var tag = datums.response[x]
                    if (!!tag && !!tag.tag_value && !typeof(tag.tag_value) !== 'undefined') {
                        values.push(tag.tag_value);    
                    }
                }
                if (values.length==0) {
                    values = [""];
                }
                cb(values);
            } else {
                cb([""]);
            }
        });
    }
});
</script>
{{template "footer"}}
{{end}}